<!doctype html>
<html lang="es">
<head>
  <link rel="manifest"           href="manifest.webmanifest">
  <meta name="theme-color"   content="#0b0c10">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <style>
    :root{
      --bg:#0b0c10;
      --card:#12131a;
      --muted:#8b90a0;
      --line:#1f2230;
      --cell:#151827;
      --cell2:#121424;
      --ok:#20c997;
      --today:#ffd43b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg),#080910);
      color:#e9ecf5;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      padding:12px 12px calc(12px + env(safe-area-inset-bottom));
    }

    .wrap{
      max-width:720px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .stats{
      position:sticky;
      top:0;
      z-index:5;
      background:rgba(18,19,26,.88);
      backdrop-filter: blur(10px);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .stats .left{
      display:flex; flex-direction:column; gap:4px;
      min-width:0;
    }
    .stats .big{
      font-size:14px;
      font-weight:700;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .stats .small{
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .bar{
      width:44%;
      min-width:140px;
      height:10px;
      background:#0f111a;
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
      flex:0 0 auto;
    }
    .bar > div{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,#5c7cfa,var(--ok));
      border-radius:999px;
      transition:width .25s ease;
    }

    .dow{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:8px;
      padding:0 2px;
      margin-top:2px;
    }
    .dow div{
      text-align:center;
      font-size:11px;
      color:var(--muted);
      letter-spacing:.4px;
      padding:6px 0;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:8px;
      padding:2px;
    }

    .cell{
      background:linear-gradient(180deg,var(--cell),var(--cell2));
      border:1px solid var(--line);
      border-radius:14px;
      aspect-ratio:1/1;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      padding:8px;
      position:relative;
      overflow:hidden;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .cell.pad{
      opacity:.18;
      filter:saturate(.3);
    }
    .date{
      font-size:12px;
      color:#cfd5e6;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }
    .date .d{
      font-weight:700;
      letter-spacing:.2px;
    }
    .badge{
      font-size:10px;
      color:#0c0d12;
      background:rgba(255,212,59,.92);
      padding:2px 6px;
      border-radius:999px;
      font-weight:800;
      display:none;
    }
    .cell.today .badge{ display:inline-flex; }

    .check{
      display:flex;
      align-items:flex-end;
      justify-content:flex-end;
      margin-top:auto;
    }
    input[type="checkbox"]{
      width:22px;
      height:22px;
      accent-color: var(--ok);
      cursor:pointer;
      transform: translateZ(0);
    }

    .cell.done{
      border-color: rgba(32,201,151,.35);
      box-shadow: 0 0 0 1px rgba(32,201,151,.2) inset;
    }
    .cell.done::after{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 20% 20%, rgba(32,201,151,.18), transparent 55%);
      pointer-events:none;
    }

    .hint{
      color:var(--muted);
      font-size:12px;
      text-align:center;
      padding:6px 0 2px;
    }

    @media (max-width:380px){
      .grid{ gap:6px; }
      .cell{ border-radius:12px; padding:7px; }
      input[type="checkbox"]{ width:20px; height:20px; }
      .bar{ min-width:120px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="stats" role="region" aria-label="Estadísticas">
      <div class="left">
        <div class="big" id="statMain">0/0</div>
        <div class="small">
          <span id="statPct">0%</span>
          <span id="statStreak">Racha: 0</span>
          <span id="statLongest">Máx: 0</span>
        </div>
      </div>
      <div class="bar" aria-hidden="true"><div id="barFill"></div></div>
    </div>

    <div class="dow" aria-hidden="true">
      <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
    </div>

    <div class="grid" id="grid" role="grid" aria-label="Calendario con casillas diarias"></div>

    <div class="hint" id="rangeHint"></div>
  </div>

<script>
(() => {
  // Rango fijo: 18/12/2025 a 18/06/2026 (inclusive)
  const START = new Date(Date.UTC(2025, 11, 18)); // 11 = diciembre
  const END   = new Date(Date.UTC(2026,  5, 18)); // 5 = junio
  const STORAGE_KEY = "dailyChecks_2025-12-18_2026-06-18_v1";

  const grid = document.getElementById("grid");
  const statMain = document.getElementById("statMain");
  const statPct = document.getElementById("statPct");
  const statStreak = document.getElementById("statStreak");
  const statLongest = document.getElementById("statLongest");
  const barFill = document.getElementById("barFill");
  const rangeHint = document.getElementById("rangeHint");

  // Helpers
  const pad2 = n => String(n).padStart(2,"0");
  const ymd = (d) => `${d.getUTCFullYear()}-${pad2(d.getUTCMonth()+1)}-${pad2(d.getUTCDate())}`;
  const cloneUTC = (d) => new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate()));
  const addDays = (d, n) => new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate()+n));

  // Lunes=0 ... Domingo=6 (a partir de getUTCDay: Domingo=0)
  const mondayIndex = (d) => (d.getUTCDay() + 6) % 7;

  const todayLocal = new Date();
  const todayUTC = new Date(Date.UTC(todayLocal.getFullYear(), todayLocal.getMonth(), todayLocal.getDate()));
  const todayKey = ymd(todayUTC);

  // Estado persistente
  let state = {};
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    state = raw ? JSON.parse(raw) : {};
  } catch { state = {}; }

  const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

  // Construir lista de fechas del rango
  const dates = [];
  for (let d = cloneUTC(START); d <= END; d = addDays(d, 1)) dates.push(cloneUTC(d));

  // Render continuo en grilla semanal, con padding al inicio para alinear lunes
  const padStart = mondayIndex(START);

  rangeHint.textContent = `18/12/25 → 18/06/26`;

  // Celdas de padding
  for (let i=0; i<padStart; i++){
    const cell = document.createElement("div");
    cell.className = "cell pad";
    cell.setAttribute("aria-hidden","true");
    grid.appendChild(cell);
  }

  // Celdas del rango
  for (const d of dates){
    const key = ymd(d);
    const day = d.getUTCDate();

    const cell = document.createElement("div");
    cell.className = "cell";
    cell.setAttribute("role","gridcell");

    if (key === todayKey) cell.classList.add("today");

    const top = document.createElement("div");
    top.className = "date";

    const dn = document.createElement("span");
    dn.className = "d";
    dn.textContent = day;

    const badge = document.createElement("span");
    badge.className = "badge";
    badge.textContent = "HOY";

    top.appendChild(dn);
    top.appendChild(badge);

    const checkWrap = document.createElement("div");
    checkWrap.className = "check";

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.inputMode = "none";
    cb.checked = !!state[key];
    cb.setAttribute("aria-label", `Marcar ${key}`);

    const syncDoneClass = () => {
      cell.classList.toggle("done", cb.checked);
    };
    syncDoneClass();

    // Tap en toda la celda (menos si está en padding)
    cell.addEventListener("click", (e) => {
      if (e.target === cb) return;
      cb.checked = !cb.checked;
      cb.dispatchEvent(new Event("change", {bubbles:true}));
    });

    cb.addEventListener("change", () => {
      state[key] = cb.checked;
      if (!cb.checked) delete state[key];
      syncDoneClass();
      save();
      updateStats();
    });

    checkWrap.appendChild(cb);
    cell.appendChild(top);
    cell.appendChild(checkWrap);
    grid.appendChild(cell);
  }

  function updateStats(){
    const total = dates.length;
    const completed = Object.keys(state).length;

    const pct = total ? Math.round((completed/total)*100) : 0;

    // Racha (consecutivos desde hoy hacia atrás, dentro del rango)
    // Si hoy está fuera del rango, usamos el último día del rango como "ancla".
    let anchor = todayUTC;
    if (anchor < START) anchor = cloneUTC(START);
    if (anchor > END) anchor = cloneUTC(END);

    let streak = 0;
    for (let d = cloneUTC(anchor); d >= START; d = addDays(d, -1)){
      const k = ymd(d);
      if (state[k]) streak++;
      else break;
    }

    // Máxima racha en el rango
    let longest = 0, run = 0;
    for (const d of dates){
      const k = ymd(d);
      if (state[k]) { run++; longest = Math.max(longest, run); }
      else run = 0;
    }

    statMain.textContent = `${completed}/${total}`;
    statPct.textContent = `${pct}%`;
    statStreak.textContent = `Racha: ${streak}`;
    statLongest.textContent = `Máx: ${longest}`;
    barFill.style.width = `${pct}%`;
  }

  updateStats();
})();
</script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js");
  }
</script>
</body>
</html>